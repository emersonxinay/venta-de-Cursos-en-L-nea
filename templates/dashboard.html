<!-- filepath: /Users/emerson/Desktop/Todo_Mac/proyectos_python/venta_cursos_pagos/templates/dashboard.html -->
{% extends "base.html" %} {% block title %}Dashboard{% endblock %} {% block
content %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/styles_dashboard.css') }}"
/>

<h1>Bienvenido al Dashboard</h1>

{% if current_user.is_authenticated and current_user.rol == 'admin' %}
<a href="{{ url_for('nuevo_curso') }}">Crear Nuevo Curso</a>
<br />
<h2>Lista de Cursos</h2>
<ul>
  {% for curso in cursos %}
  <li>
    {{ curso.nombre }} - {{ curso.precio }} USD
    <a href="{{ url_for('editar_curso', curso_id=curso.id) }}">Editar</a>
    <a href="{{ url_for('eliminar_curso', curso_id=curso.id) }}">Eliminar</a>
  </li>
  {% endfor %}
</ul>
{% endif %} {% if current_user.is_authenticated %}
<h2>Mis cursos Comprado</h2>
<ul>
  {% for venta in mis_ventas %} {% if venta.estado_transferencia == 'confirmada'
  and venta.fecha_expiracion > current_time %}
  <li>
    Curso: {{ venta.curso.nombre }} - Método de Pago: {{ venta.metodo_pago }} -
    Fecha: {{ venta.fecha_venta }} - Expira: {{ venta.fecha_expiracion }}
    <a href="{{ url_for('ver_curso', curso_id=venta.curso.id) }}">Ver Curso</a>
  </li>
  {% endif %} {% endfor %}
</ul>

<h2>Cursos Pendientes de Confirmación por transferencia</h2>
<ul>
  {% for venta in mis_ventas %} {% if venta.estado_transferencia == 'pendiente'
  %}
  <li>
    Curso: {{ venta.curso.nombre }} - Método de Pago: {{ venta.metodo_pago }} -
    Fecha: {{ venta.fecha_venta }} - <span>Pendiente de Confirmación</span>
  </li>
  {% endif %} {% endfor %}
</ul>
{% endif %}

<h2>Cursos Disponibles</h2>
<ul>
  {% for curso in cursos %}
  <li>
    {{ curso.nombre }} - {{ curso.precio }} USD
    <a href="{{ url_for('ver_curso', curso_id=curso.id) }}">Ver Detalle</a>
    {% if current_user.is_authenticated %} {% if curso.id in
    cursos_comprados_ids %}
    <span>Ya comprado</span>
    {% elif curso.id in cursos_pendientes_ids %}
    <span>Pendiente de Confirmación</span>
    {% else %}
    <a href="{{ url_for('comprar_curso', curso_id=curso.id) }}">Comprar</a>
    {% endif %} {% else %}
    <span>Inicia sesión para comprar</span>
    {% endif %}
  </li>
  {% endfor %}
</ul>
{% endblock %}
